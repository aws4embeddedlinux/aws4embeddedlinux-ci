<!DOCTYPE html><html class="default" lang="en" data-base="."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>aws4embeddedlinux-cdk-lib</title><meta name="description" content="Documentation for aws4embeddedlinux-cdk-lib"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">aws4embeddedlinux-cdk-lib</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>aws4embeddedlinux-cdk-lib</h1></div><div class="tsd-panel tsd-typography"><a id="aws4embeddedlinux-ci" class="tsd-anchor"></a><h1 class="tsd-anchor-link">aws4embeddedlinux-ci<a href="#aws4embeddedlinux-ci" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>aws4embeddedlinux-ci</code> library helps you deploy an AWS cloud infrastructure supporting the Embedded Linux builds for your project using <a href="https://github.com/aws/aws-cdk">AWS CDK</a>.</p>
<a id="table-of-contents" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Table of Contents<a href="#table-of-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ol>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#api-documentation">API documentation</a></li>
<li><a href="#project-build-with-aws-codepipeline">Project Build with AWS CodePipeline</a></li>
<li><a href="#project-build-with-aws-codebuild-as-action-runner">Project Build with AWS CodeBuild as Action Runner</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#development-setup">Development Setup</a></li>
<li><a href="#known-issues">Known issues</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ol>
<a id="architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture<a href="#architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This is the overall architecture pattern used to deploy the build pipeline:</p>
<p><img src="media/architecture-v0.2.x.svg" alt="architecture overview" title="Architecture"></p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="api-documentation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">API documentation<a href="#api-documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <a href="https://aws4embeddedlinux.github.io/aws4embeddedlinux-ci/">API documentation</a> is generated automatically using <a href="https://typedoc.org/">Typedoc</a>.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="project-build-with-aws-codepipeline" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Project Build with AWS CodePipeline<a href="#project-build-with-aws-codepipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Several pipelines are provided in this library, each one demonstrating a different aspect of how to build a Yocto image with AWS.</p>
<p>Once deployed, ou can review the pipeline execution from the <code>Developer Tools &gt; Pipeline - CodePipeline &gt; Pipelines</code> page in the AWS Console.</p>
<p>From the pipeline page, you can find the source repository (S3), the CodeBuild Project (with the build logs), and the S3 bucket that the image is uploaded to, at the end.</p>
<p>Each pipelines will refresh/re-run automatically every week using AWS EventBridge in order to grab the latest updates.</p>
<a id="poky" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><ins><strong>Poky</strong></ins><a href="#poky" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The pipeline name will end with <strong><code>poky</code></strong>.</p>
<p>This example will build the <code>core-image-minimal</code> image from Poky using the repo tool to manage layers. CVE checking is also enabled in the buildspec file.</p>
<p><strong><em>Expected build times</em></strong>:</p>
<ul>
<li>First build: <strong>32 minutes</strong></li>
<li>Rebuild (without any change, just use sstate cache): <strong>8 minutes</strong></li>
</ul>
<a id="poky-ec2-ami" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><ins><strong>Poky EC2 AMI</strong></ins><a href="#poky-ec2-ami" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The pipeline name will end with <strong><code>poky-ami</code></strong>.</p>
<p>Yocto can be used to create an EC2 AMI. This example builds an AMI based on Poky and meta-aws and exports it to your AMI registry using the <a href="https://docs.aws.amazon.com/vm-import/latest/userguide/what-is-vmimport.html">VM Import/Export Service</a>.</p>
<p><strong><em>Expected build times</em></strong>:</p>
<ul>
<li>First build: <strong>52 minutes</strong></li>
<li>Rebuild (without any change, just use sstate cache): <strong>17 minutes</strong></li>
</ul>
<a id="kas" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><ins><strong>Kas</strong></ins><a href="#kas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The pipeline name will end with <strong><code>kas</code></strong>.</p>
<p>The Kas example shows how to use a <a href="https://github.com/aws4embeddedlinux/aws4embeddedlinux-ci/blob/main/source-repo/kas/kas.yml">Kas Config</a> to manage layers.</p>
<p>This tool can help programatically manage layers and config with tighter Yocto integration than Git Submodules or the Repo tool.</p>
<p><strong><em>Expected build times</em></strong>:</p>
<ul>
<li>First build: <strong>36 minutes</strong></li>
<li>Rebuild (without any change, just use sstate cache): <strong>11 minutes</strong></li>
</ul>
<a id="qemu" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><ins><strong>QEmu</strong></ins><a href="#qemu" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The pipeline name will end with <strong><code>qemu</code></strong>.</p>
<p>This example builds a Qemu based image using <a href="https://github.com/aws4embeddedlinux/meta-aws-demos">meta-aws-demos</a>.</p>
<p>The Qemu image can be run in the CodeBuild environment. Using SLIRP networking, <a href="https://docs.yoctoproject.org/singleindex.html#performing-automated-runtime-testing">OEQA testing</a> such as ptest can be run in the pipeline.</p>
<p><strong><em>Expected build times</em></strong>:</p>
<ul>
<li>First build: <strong>45 minutes</strong></li>
<li>Rebuild (without any change, just use sstate cache): <strong>14 minutes</strong></li>
</ul>
<a id="nxp--imx" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><ins><strong>NXP / IMX</strong></ins><a href="#nxp--imx" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The pipeline name will end with <strong><code>nxp</code></strong>.</p>
<p>This example will build an image for the <a href="https://www.nxp.com/design/development-boards/i-mx-evaluation-and-development-boards/evaluation-kit-for-the-i-mx-6ull-and-6ulz-applications-processor:MCIMX6ULL-EVK">i.MX 6ULL EVK</a> board.</p>
<p><strong>NXP requires users to accept and comply with a EULA in order to build</strong> and, for this reason, <strong>the buildspec will require modification before the build succeeds</strong>.</p>
<p>See the <a href="https://www.nxp.com/docs/en/user-guide/IMX_YOCTO_PROJECT_USERS_GUIDE.pdf">IMX Yocto Users Guide</a> for more detail.</p>
<p><strong><em>Expected build times</em></strong>:</p>
<ul>
<li>First build: <strong>xx minutes</strong></li>
<li>Rebuild (without any change, just use sstate cache): <strong>xx minutes</strong></li>
</ul>
<a id="renesas" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><ins><strong>Renesas</strong></ins><a href="#renesas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This example is based on the <a href="https://elinux.org/R-Car/Boards/Yocto-Gen3/v5.9.0">Yocto / Renesas R-Car work</a> to build an image for Renesas R-Car-H3 Starter Kit Premier board (unofficial name - H3ULCB) including the proprietary graphics and multimedia drivers from Renesas.</p>
<p>You will need to download the Multimedia and Graphics library and related Linux drivers from the following link (registration necessary):</p>
<ul>
<li><a href="https://www.renesas.com/us/en/application/automotive/r-car-h3-m3-h2-m2-e2-documents-software">https://www.renesas.com/us/en/application/automotive/r-car-h3-m3-h2-m2-e2-documents-software</a></li>
</ul>
<p><strong>Download the following files:</strong></p>
<ul>
<li>R-Car_Gen3_Series_Evaluation_Software_Package_for_Linux-20220121</li>
<li>R-Car_Gen3_Series_Evaluation_Software_Package_of_Linux_Drivers-20220121</li>
</ul>
<p>Graphic drivers are required for Wayland. Multimedia drivers are optional.</p>
<p><strong>Steps to build the image:</strong></p>
<ul>
<li>Create a folder named <code>proprietary</code> in the root of the source repo</li>
<li>Copy the downloaded files into the <code>proprietary</code> folder</li>
<li>Uncomment the <code>#TODO</code> line in the <code>build.sh</code> file in the source repo</li>
<li>Deploy the build pipeline</li>
</ul>
<p>A build should automatically start. Once it succeeds you will get an image containing the proprietary graphics and multimedia drivers.</p>
<p><strong><em>Expected build times</em></strong>:</p>
<ul>
<li>First build: <strong>30 minutes</strong></li>
<li>Rebuild (without any change, just use sstate cache): <strong>9 minutes</strong></li>
</ul>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="project-build-with-aws-codebuild-as-action-runner" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Project Build with AWS CodeBuild as Action Runner<a href="#project-build-with-aws-codebuild-as-action-runner" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This will create an AWS CodeBuild project ready to build Embedded Linux which can be used to connect to an external source, e.g. <a href="https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html">GitHub Actions</a>. This is not using any AWS CodePipeline as in the the Pipeline examples section.</p>
<p>You can use the following <a href="https://github.com/aws4embeddedlinux/meta-aws-demos/blob/master/.github/workflows/build-gg.yml">example</a> for your GitHub Action.</p>
<p>We recommend you to clone the created AWS CodeBuild project and then proceed with the GitHub Action configuration.
However, this will result in the use of the same EFS file system across projects.</p>
<p>Using the AWS CodeBuild project requires a source to be configured manually in the AWS Console at <code>Developer Tools &gt; Build - CodeBuild &gt; Projects</code>.</p>
<p>To configure the AWS CodeBuild source connection to a GitHub repository, you will need to:</p>
<ul>
<li>Select the AWS CodeBuild project (<code>aws4el-ci-codebuild-project</code>)</li>
<li>Select the <code>Project Details</code> tab</li>
<li>Scroll to the <code>Source</code> section and click on <strong>Edit</strong>.</li>
<li>Select <strong><code>GitHub</code></strong> as a <strong>Source provider</strong>. Configure the access to your repository</li>
<li>Scroll to the <strong>Primary source webhook events</strong> section, enable <strong>Rebuild every time a code change is pushed to this repository</strong></li>
<li>Expand the <strong>Webhook event filter groups</strong> section and click on <strong>Add filter group</strong> if no group is present, then select <strong>WORKFLOW_JOB_QUEUED</strong> as <strong>Filter group 1</strong></li>
</ul>
<p>Modify your repository GitHub action by replacing the following line:</p>
<pre><code><span class="hl-0">runs</span><span class="hl-1">-</span><span class="hl-2">on</span><span class="hl-1">: </span><span class="hl-0">$</span><span class="hl-1">{{ </span><span class="hl-0">vars</span><span class="hl-1">.</span><span class="hl-3">CODEBUILD_RUNNER_NAME</span><span class="hl-1"> }}-</span><span class="hl-0">$</span><span class="hl-1">{{ </span><span class="hl-0">github</span><span class="hl-1">.</span><span class="hl-0">run_id</span><span class="hl-1"> }}-</span><span class="hl-0">$</span><span class="hl-1">{{ </span><span class="hl-0">github</span><span class="hl-1">.</span><span class="hl-0">run_attempt</span><span class="hl-1"> }}</span>
</code><button>Copy</button></pre>

<p>with:</p>
<pre><code><span class="hl-0">runs</span><span class="hl-1">-</span><span class="hl-2">on</span><span class="hl-1">: </span><span class="hl-0">codebuild</span><span class="hl-1">-&lt;</span><span class="hl-4">project</span><span class="hl-1">-</span><span class="hl-4">name</span><span class="hl-1">&gt;-</span><span class="hl-0">$</span><span class="hl-1">{{ </span><span class="hl-0">github</span><span class="hl-1">.</span><span class="hl-0">run_id</span><span class="hl-1"> }}-</span><span class="hl-0">$</span><span class="hl-1">{{ </span><span class="hl-0">github</span><span class="hl-1">.</span><span class="hl-0">run_attempt</span><span class="hl-1"> }}</span>
</code><button>Copy</button></pre>

<p><code>&lt;project-name&gt;</code> should be replaced by your AWS CodeBuild project name (<code>aws4el-ci-codebuild-project</code>).
There might be more than one occuerence to replace in the file.</p>
<p>Refer to the following <a href="https://github.com/aws4embeddedlinux/meta-aws-demos/blob/master/.github/workflows/build-gg.yml">example</a> for more details.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="setup" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Setup<a href="#setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>In order to use this library, you must first set up an <a href="https://docs.aws.amazon.com/cdk/v2/guide/getting_started.html">AWS CDK</a> project, including
installing the CDK tool and bootstrapping the account you wish to deploy to.</p>
<p>Additionally, you must have <a href="https://nodejs.org/en/">NodeJS</a> installed.</p>
<div class="tsd-alert tsd-alert-note"><div class="tsd-alert-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="assets/icons.svg#icon-alertNote"></use></svg><span>Note</span></div><p></p>
<p>This library is tested against Node Versions 22. If these version is not available for your system, we recommend using <a href="https://github.com/nvm-sh/nvm">NVM</a> to install a compatible version.</p>
</div>
<p>You can also use the <a href="https://github.com/aws4embeddedlinux/aws4embeddedlinux-ci-examples">sample project code</a> provided to get started and deploy the stacks.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="setting-up-a-new-project" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Setting Up A New Project<a href="#setting-up-a-new-project" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In order to create a new project, you will need to initialize a new CDK project.</p>
<p>More details can be found in the <a href="https://docs.aws.amazon.com/cdk/v2/guide/getting_started.html">CDK Getting Started Documentation</a>.</p>
<p>The following commands will create a new CDK project named <code>my-project</code>:</p>
<pre><code class="bash"><span class="hl-5">mkdir</span><span class="hl-1"> </span><span class="hl-6">my-project</span><br/><span class="hl-5">cd</span><span class="hl-1"> </span><span class="hl-6">my-project</span><br/><span class="hl-5">cdk</span><span class="hl-1"> </span><span class="hl-6">init</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> </span><span class="hl-7">--language</span><span class="hl-1"> </span><span class="hl-6">typescript</span>
</code><button type="button">Copy</button></pre>

<p>Then you will need to install the CDK library including the <code>aws4embeddedlinux-ci</code> library either using <code>npm</code>:</p>
<pre><code class="bash"><span class="hl-5">npm</span><span class="hl-1"> </span><span class="hl-6">install</span><span class="hl-1"> </span><span class="hl-6">aws4embeddedlinux/aws4embeddedlinux-ci</span>
</code><button type="button">Copy</button></pre>

<p>of `yarn':</p>
<pre><code class="bash"><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">add</span><span class="hl-1"> </span><span class="hl-6">aws4embeddedlinux-cdk-lib@aws4embeddedlinux/aws4embeddedlinux-ci</span><br/><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">install</span>
</code><button type="button">Copy</button></pre>

<blockquote>
<p>If you are not familliar with Yarn, please refer to the <a href="https://yarnpkg.com/getting-started">documentation</a>.</p>
</blockquote>
<p>Once added, you can start creatin your application using the library.</p>
<p>For example, you can start by importing classes using:</p>
<pre><code class="ts"><span class="hl-8">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">EmbeddedLinuxCodePipelineBaseImageStack</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">EmbeddedLinuxCodePipelineStack</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">EmbeddedLinuxCodeBuildProjectStack</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">PipelineResourcesStack</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">ProjectType</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-6">&quot;aws4embeddedlinux-cdk-lib&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Then deploy the base resources and base image pipeline stacks:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-3">pipelineResourcesStack</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-5">PipelineResourcesStack</span><span class="hl-1">(</span><span class="hl-0">app</span><span class="hl-1">, </span><span class="hl-6">`demo-resources`</span><span class="hl-1">, {...});</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-3">baseImageStack</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-5">EmbeddedLinuxCodePipelineBaseImageStack</span><span class="hl-1">(</span><span class="hl-0">app</span><span class="hl-1">, </span><span class="hl-6">`demo-pipeline-base-image`</span><span class="hl-1">, {...});</span>
</code><button type="button">Copy</button></pre>

<p>And ultimately deploy the target pipeline:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-3">projectPipeline</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-5">EmbeddedLinuxCodePipelineStack</span><span class="hl-1">(</span><span class="hl-0">app</span><span class="hl-1">, </span><span class="hl-6">&quot;demo-project&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">projectType:</span><span class="hl-1"> </span><span class="hl-0">ProjectType</span><span class="hl-1">.</span><span class="hl-0">Poky</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">ecrRepository:</span><span class="hl-1"> &lt;</span><span class="hl-4">ecrRepository</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">ecrRepositoryImageTag:</span><span class="hl-1"> &lt;</span><span class="hl-4">ecrRepositoryImageTag</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">pipelineSourceBucket:</span><span class="hl-1"> &lt;</span><span class="hl-4">SourceBucket</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">pipelineArtifactBucket:</span><span class="hl-1"> &lt;</span><span class="hl-4">ArtifactBucket</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">pipelineOutputBucket:</span><span class="hl-1"> &lt;</span><span class="hl-4">OutputBucket</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">vpc:</span><span class="hl-1"> &lt;</span><span class="hl-4">vpc</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">encryptionKey:</span><span class="hl-1"> &lt;</span><span class="hl-4">encryptionKey</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Refer to the <a href="https://aws4embeddedlinux.github.io/aws4embeddedlinux-ci">API Documentation</a> and the <a href="https://github.com/aws4embeddedlinux/aws4embeddedlinux-ci-examples">sample</a> for more details.</p>
<p>Once you have completed the code of your application, you can deploy the CDK stack using:</p>
<pre><code class="bash"><span class="hl-5">cdk</span><span class="hl-1"> </span><span class="hl-6">deploy</span>
</code><button type="button">Copy</button></pre>

<p>After the CDK application is successfully deployed, the 'Base Image' pipeline needs to complete successfully.</p>
<p>This will create an Ubuntu based container for building the Yocto images.</p>
<div class="tsd-alert tsd-alert-note"><div class="tsd-alert-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="assets/icons.svg#icon-alertNote"></use></svg><span>Note</span></div><p></p>
<p>This container is used by the other pipelines. If the other pipelines are run before this container is created and pushed to <a href="https://aws.amazon.com/ecr/">ECR</a>, they will fail.</p>
<p>The 'Base Image' pipeline will run weekly by default to keep the container patched and up to date.</p>
</div>
<div class="tsd-alert tsd-alert-note"><div class="tsd-alert-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="assets/icons.svg#icon-alertNote"></use></svg><span>Note</span></div><p></p>
<p>We recommend you to deploy first the 'Base Image' pipeline and once the pipeline completes successfully, then you can deploy the other pipelines in you application as described in the <a href="https://github.com/aws4embeddedlinux/aws4embeddedlinux-ci-examples">sample</a>.</p>
</div>
<p>Once your pipelines completes successfully, the Yocto deploy directory generated content will be pushed into a S3 bucket.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="development-setup" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Development Setup<a href="#development-setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The repository is leveraging Yarn 2 and if you are not familliar with Yarn, please refer to the <a href="https://yarnpkg.com/getting-started">documentation</a>.</p>
<p>If you are looking to develop new feature, you can use <a href="https://classic.yarnpkg.com/lang/en/docs/cli/link/k"><code>yarn link</code></a> to develop with a local copy of this repo.</p>
<p>In this library repo, execute the following:</p>
<pre><code class="bash"><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">install</span><br/><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">run</span><span class="hl-1"> </span><span class="hl-6">build</span><br/><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">link</span>
</code><button type="button">Copy</button></pre>

<p>and in your project folder:</p>
<pre><code class="bash"><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">install</span><br/><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">link</span><span class="hl-1"> </span><span class="hl-6">&quot;aws4embeddedlinux-cdk-lib&quot;</span><br/><span class="hl-5">yarn</span><span class="hl-1"> </span><span class="hl-6">run</span><span class="hl-1"> </span><span class="hl-6">build</span>
</code><button type="button">Copy</button></pre>

<p>This will link through the system <code>node_modules</code> install.</p>
<blockquote>
<p><em>Note:</em></p>
<p>You should not install / reference the <code>aws4embeddedlinux/aws4embeddedlinux-ci</code> library in your <code>package.json</code> when using this approach.</p>
</blockquote>
<blockquote>
<p><em>Note:</em></p>
<p>After changing the code for the <code>aws4embeddedlinux/aws4embeddedlinux-ci</code> library, you will need to run <code>yarn run build</code> for changes to be available in your current project.</p>
</blockquote>
<blockquote>
<p><em>Note:</em></p>
<p>When using a system node install on Linux, this can require sudo access.
To avoid this, use a <a href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm#using-a-node-version-manager-to-install-nodejs-and-npm">node version manager</a> or <a href="https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally">set a node prefix</a>.</p>
</blockquote>
<a id="using-git-credentials-and-build-time-secrets" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using Git Credentials and Build Time Secrets<a href="#using-git-credentials-and-build-time-secrets" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">AWS Secrets Manager</a> is the preferred method for adding and using secrets in your pipelines.</p>
<p>The service provides a structured means of access and avoids the pitfalls of putting secrets in environment variables, source repos, etc.</p>
<p>The following steps detaisl at a high level, how you can enable the use of AWS Secrets Manager in your pipelines:</p>
<ul>
<li>
<p>Create a <em>Secret</em> in Secrets Manager and add your secret value.</p>
</li>
<li>
<p>Grant access permissions to the CodeBuild pipeline project.</p>
</li>
<li>
<p>Create a <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.PolicyStatement.html">Policy Statement</a> which allows <code>secretsmanager:GetSecretValue</code> for your secret.</p>
</li>
<li>
<p>Add this policy statement to the <code>buildPolicyAdditions</code> props for the <code>EmbeddedLinuxPipelineStack</code>. e.g.</p>
<pre><code class="typescript"><span class="hl-8">import</span><span class="hl-1"> </span><span class="hl-7">*</span><span class="hl-1"> </span><span class="hl-8">as</span><span class="hl-1"> </span><span class="hl-0">iam</span><span class="hl-1"> </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-6">&quot;aws-cdk-lib/aws-iam&quot;</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-3">projectPipeline</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-5">EmbeddedLinuxCodePipelineStack</span><span class="hl-1">(</span><span class="hl-0">app</span><span class="hl-1">, </span><span class="hl-6">&quot;MyPokyPipeline&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">projectType:</span><span class="hl-1"> </span><span class="hl-0">ProjectType</span><span class="hl-1">.</span><span class="hl-0">Poky</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">ecrRepository:</span><span class="hl-1"> &lt;</span><span class="hl-4">ecrRepository</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">ecrRepositoryImageTag:</span><span class="hl-1"> &lt;</span><span class="hl-4">ecrRepositoryImageTag</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">pipelineSourceBucket:</span><span class="hl-1"> &lt;</span><span class="hl-4">SourceBucket</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">pipelineArtifactBucket:</span><span class="hl-1"> &lt;</span><span class="hl-4">ArtifactBucket</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">pipelineOutputBucket:</span><span class="hl-1"> &lt;</span><span class="hl-4">OutputBucket</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">vpc:</span><span class="hl-1"> &lt;</span><span class="hl-4">vpc</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">encryptionKey:</span><span class="hl-1"> &lt;</span><span class="hl-4">encryptionKey</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-0">buildPolicyAdditions:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-0">iam</span><span class="hl-1">.</span><span class="hl-0">PolicyStatement</span><span class="hl-1">.</span><span class="hl-5">fromJson</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-0">Effect:</span><span class="hl-1"> </span><span class="hl-6">&quot;Allow&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">Action:</span><span class="hl-1"> </span><span class="hl-6">&quot;secretsmanager:GetSecretValue&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">Resource:</span><br/><span class="hl-1">        </span><span class="hl-6">&quot;arn:aws:secretsmanager:us-west-2:123456789012:secret:my-secret-??????&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>The secret can then be used in the CodeBuild Project by adding it to the BuildSpec.</p>
<pre><code class="yaml"><span class="hl-9">env</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-9">secrets-manager</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-9">SECRET_VALUE</span><span class="hl-1">: </span><span class="hl-6">&quot;&lt;Secret ARN&gt;&quot;</span>
</code><button type="button">Copy</button></pre>

</li>
</ul>
<p>See the <a href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html">CodeBuild Documentation</a> for more details.</p>
<a id="cve-checking-with-yocto" class="tsd-anchor"></a><h3 class="tsd-anchor-link">CVE Checking With Yocto<a href="#cve-checking-with-yocto" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>CVE checking is enabled in the reference implementations. Details on this can be found in the <a href="https://docs.yoctoproject.org/4.0.13/singleindex.html#checking-for-vulnerabilities">Yocto documentation</a>.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="known-issues" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Known issues<a href="#known-issues" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>The use of this CDK library is currently not supported in Windows environments (you can still use WSL).</li>
<li>When using AWS Cloud9, a micro instance type will run out of memory.</li>
<li>Deletion of stacks while a CodePipeline is running can lead to unexpected behaviours.</li>
<li>The NXP-IMX pipeline will fail unless you adjust the build spec file and address the licence acceptance requirement.</li>
</ul>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="security" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Security<a href="#security" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>See <a href="media/SECURITY.md">SECURITY</a> for more information about reporting issues with this project.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="contributing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>See <a href="media/CONTRIBUTING.md">CONTRIBUTING</a> for more information.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
<a id="license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This library is licensed under the MIT-0 License. See the <a href="media/LICENSE">LICENSE</a> file.</p>
<p><a href="#aws4embeddedlinux-ci">Bask to the top</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#aws4embeddedlinux-ci"><span>aws4embeddedlinux-<wbr/>ci</span></a><ul><li><a href="#table-of-contents"><span>Table of <wbr/>Contents</span></a></li><li><a href="#architecture"><span>Architecture</span></a></li><li><a href="#api-documentation"><span>API documentation</span></a></li><li><a href="#project-build-with-aws-codepipeline"><span>Project <wbr/>Build with AWS <wbr/>Code<wbr/>Pipeline</span></a></li><li><ul><li><a href="#poky"><span>&lt;ins&gt;<wbr/>Poky&lt;/ins&gt;</span></a></li><li><a href="#poky-ec2-ami"><span>&lt;ins&gt;<wbr/>Poky EC2 AMI&lt;/ins&gt;</span></a></li><li><a href="#kas"><span>&lt;ins&gt;<wbr/>Kas&lt;/ins&gt;</span></a></li><li><a href="#qemu"><span>&lt;ins&gt;QEmu&lt;/ins&gt;</span></a></li><li><a href="#nxp--imx"><span>&lt;ins&gt;NXP / IMX&lt;/ins&gt;</span></a></li><li><a href="#renesas"><span>&lt;ins&gt;<wbr/>Renesas&lt;/ins&gt;</span></a></li></ul></li><li><a href="#project-build-with-aws-codebuild-as-action-runner"><span>Project <wbr/>Build with AWS <wbr/>Code<wbr/>Build as <wbr/>Action <wbr/>Runner</span></a></li><li><a href="#setup"><span>Setup</span></a></li><li><ul><li><a href="#setting-up-a-new-project"><span>Setting <wbr/>Up <wbr/>A <wbr/>New <wbr/>Project</span></a></li></ul></li><li><a href="#development-setup"><span>Development <wbr/>Setup</span></a></li><li><ul><li><a href="#using-git-credentials-and-build-time-secrets"><span>Using <wbr/>Git <wbr/>Credentials and <wbr/>Build <wbr/>Time <wbr/>Secrets</span></a></li><li><a href="#cve-checking-with-yocto"><span>CVE <wbr/>Checking <wbr/>With <wbr/>Yocto</span></a></li></ul></li><li><a href="#known-issues"><span>Known issues</span></a></li><li><a href="#security"><span>Security</span></a></li><li><a href="#contributing"><span>Contributing</span></a></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">aws4embeddedlinux-cdk-lib</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
